# ===========================================
# NGINX SECURITY HARDENING
# ===========================================
# Incluir en el bloque server de tu sitio

# --- SECURITY HEADERS ---
# Prevenir clickjacking
add_header X-Frame-Options "SAMEORIGIN" always;

# Prevenir MIME type sniffing
add_header X-Content-Type-Options "nosniff" always;

# Habilitar XSS filter del navegador
add_header X-XSS-Protection "1; mode=block" always;

# Política de referrer
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Content Security Policy (ajustar según necesidades)
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob:; font-src 'self' data:; connect-src 'self' wss: https:; frame-ancestors 'self';" always;

# Permissions Policy
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# Strict Transport Security (HSTS) - 1 año
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# --- OCULTAR INFORMACIÓN DEL SERVIDOR ---
server_tokens off;
more_clear_headers Server;

# --- LIMITAR TAMAÑO DE REQUESTS ---
client_max_body_size 10M;
client_body_buffer_size 128k;
client_header_buffer_size 1k;
large_client_header_buffers 4 16k;

# --- TIMEOUTS PARA PREVENIR SLOWLORIS ---
client_body_timeout 12;
client_header_timeout 12;
keepalive_timeout 15;
send_timeout 10;

# --- BLOQUEAR USER AGENTS MALICIOSOS ---
if ($http_user_agent ~* (wget|curl|libwww|python|nikto|sqlmap|nmap|masscan)) {
    return 403;
}

# --- BLOQUEAR MÉTODOS HTTP NO NECESARIOS ---
if ($request_method !~ ^(GET|POST|PUT|DELETE|OPTIONS|HEAD)$) {
    return 405;
}
